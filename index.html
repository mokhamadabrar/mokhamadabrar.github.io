<!doctype html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- === SEO dan Media Sosial === -->
		<title>Form Observasi Keselamatan (K3) | Safety Observation Form</title>
		<meta
			name="description"
			content="Laporkan temuan keselamatan (K3), baik perilaku aman/tidak aman maupun kondisi aman/tidak aman, melalui formulir observasi digital ini."
		/>
		<meta
			name="keywords"
			content="K3, HSE, Form Keselamatan, Safety Observation, Lapor K3, Form Observasi K3"
		/>

		<!-- Open Graph (untuk Facebook, LinkedIn, dll.) -->
		<meta property="og:title" content="Form Observasi Keselamatan (K3)" />
		<meta
			property="og:description"
			content="Laporkan temuan K3 dengan mudah menggunakan formulir observasi online ini."
		/>
		<meta property="og:type" content="website" />
		<meta
			property="og:image"
			content="https://mokhamadabrar.github.io/img/observation20.webp"
		/>
		<meta property="og:url" content="https://mokhamadabrar.github.io/" />
		<!-- Ganti dengan URL Anda nanti -->

		<!-- Twitter Card -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content="Form Observasi Keselamatan (K3)" />
		<meta
			name="twitter:description"
			content="Laporkan temuan K3 dengan mudah menggunakan formulir observasi online ini."
		/>
		<meta
			name="twitter:image"
			content="https://mokhamadabrar.github.io/img/observation20.webp"
		/>
		<!-- === AKHIR SEO === -->

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
		/>

		<!-- EmailJS SDK -->
		<script
			type="text/javascript"
			src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
		></script>
		<script type="text/javascript">
			(function () {
				emailjs.init("pOS8CxS4h5ruwVoYh"); // Ganti dengan Public Key EmailJS Anda
			})();
		</script>

		<style>
			body {
				font-family:
					"Inter",
					-apple-system,
					BlinkMacSystemFont,
					"Segoe UI",
					Roboto,
					Helvetica,
					Arial,
					sans-serif;
				background-color: #f4f7f6;
				background-image: linear-gradient(to bottom right, #f8f9fa, #e9ecef);
				margin: 0;
				padding: 20px;
				color: #333;
				min-height: 100vh;
			}

			#logout-btn {
				position: absolute;
				top: 15px;
				right: 15px;
				background-color: rgba(244, 67, 54, 0.8);
				color: white;
				border: none;
				padding: 8px 12px;
				border-radius: 6px;
				cursor: pointer;
				font-size: 14px;
				font-weight: bold;
				backdrop-filter: blur(3px);
				transition: background-color 0.3s ease;
			}

			#logout-btn:hover {
				background-color: #d32f2f;
			}

			.container {
				max-width: 800px;
				margin: 20px auto;
			}

			.header-banner {
				height: 180px;
				background-image: url("https://mokhamadabrar.github.io/img/construction.webp");
				background-size: cover;
				background-position: center center;
				position: relative;
			}

			.header-logo {
				position: absolute;
				bottom: 10px;
				left: 15px;
				height: 50px;
				width: auto;
				max-width: 100px;
				object-fit: contain;
				background-color: rgba(255, 255, 255, 0.7);
				padding: 5px;
				border-radius: 8px;
				backdrop-filter: blur(3px);
			}

			.language-buttons {
				position: absolute;
				bottom: 15px;
				right: 15px;
				display: flex;
				gap: 10px;
				background-color: rgba(255, 255, 255, 0.7);
				padding: 5px 10px;
				border-radius: 8px;
				backdrop-filter: blur(3px);
			}

			.language-button {
				cursor: pointer;
				width: 30px;
				height: 30px;
				border-radius: 50%;
				overflow: hidden;
				box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
				transition:
					transform 0.2s ease,
					box-shadow 0.2s ease;
				border: 2px solid transparent;
			}

			.language-button:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
			}

			.language-button.active {
				border: 2px solid #007bff;
			}

			.language-button img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			h1 {
				text-align: center;
				color: #2c3e50;
				margin-bottom: 25px;
				font-size: 24px;
				font-weight: 700;
			}

			fieldset {
				border: none;
				padding: 0;
				margin: 0;
			}

			legend {
				font-weight: 600;
				color: #007bff;
				padding: 0 10px;
				font-size: 18px;
				border-bottom: 2px solid #007bff;
				padding-bottom: 5px;
				margin-left: -10px;
			}

			.form-group {
				margin-bottom: 15px;
			}

			label {
				display: block;
				font-weight: 600;
				margin-bottom: 6px;
				font-size: 14px;
			}

			/* Modern Form Styles */
			input[type="text"],
			input[type="date"],
			input[type="number"],
			input[type="email"],
			select,
			textarea {
				width: 100%;
				padding: 10px 12px;
				border: 1px solid #dfe6e9;
				border-radius: 6px;
				box-sizing: border-box;
				font-size: 15px;
				background-color: #fdfdfd;
				transition:
					border-color 0.3s ease,
					box-shadow 0.3s ease;
				margin-top: 5px;
				font-family: "Inter", sans-serif; /* Ensure font consistency */
			}

			select {
				appearance: none;
				-webkit-appearance: none;
				-moz-appearance: none;
				background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2334495e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
				background-repeat: no-repeat;
				background-position: right 10px center;
				background-size: 16px;
				cursor: pointer;
				padding-right: 35px; /* Space for the arrow */
			}

			input[type="text"]:focus,
			input[type="date"]:focus,
			input[type="number"]:focus,
			input[type="email"]:focus,
			select:focus,
			textarea:focus {
				border-color: #007bff;
				box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
				outline: none;
			}

			select:hover {
				border-color: #b2bec3;
			}

			input[type="file"] {
				padding: 5px;
				background-color: #f4f7f6;
			}

			textarea {
				resize: vertical;
				min-height: 80px;
			}

			.radio-group div {
				margin-bottom: 8px;
				display: flex;
				align-items: center;
			}

			.radio-group label {
				font-weight: normal;
				margin-bottom: 0;
				margin-left: 8px;
				font-size: 15px;
			}

			input[type="radio"] {
				transform: scale(1.1);
				margin-right: 5px;
			}

			.radio-group-grid {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 8px;
				background-color: #ffffff;
				padding: 15px;
				border-radius: 6px;
				border: 1px solid #dfe6e9;
			}

			.radio-group-grid div {
				display: flex;
				align-items: center;
			}

			.radio-group-grid label {
				font-weight: normal;
				margin-bottom: 0;
				margin-left: 8px;
				font-size: 14px;
			}

			.category-subtitle {
				font-weight: bold;
				margin-top: 15px;
				margin-bottom: 10px;
				color: #34495e;
				font-size: 13px;
			}

			@media (max-width: 600px) {
				.radio-group-grid {
					grid-template-columns: 1fr;
				}
				body {
					padding: 10px;
				}
			}

			.submit-btn {
				display: block;
				width: 100%;
				padding: 12px 15px;
				background-image: linear-gradient(to right, #007bff, #0056b3);
				background-color: #007bff;
				color: white;
				border: none;
				border-radius: 6px;
				font-size: 16px;
				font-weight: bold;
				cursor: pointer;
				transition: all 0.3s ease;
				box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
			}

			.submit-btn:hover {
				background-image: linear-gradient(to right, #0056b3, #007bff);
				transform: translateY(-2px);
				box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
			}

			.whatsapp-btn {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 10px;
				width: 100%;
				padding: 12px 15px;
				margin-top: 15px;
				background-image: linear-gradient(to right, #25d366, #128c7e);
				background-color: #25d366;
				color: white;
				border: none;
				border-radius: 6px;
				font-size: 16px;
				font-weight: bold;
				cursor: pointer;
				transition: all 0.3s ease;
				box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
			}

			.whatsapp-btn:hover {
				background-image: linear-gradient(to right, #128c7e, #25d366);
				transform: translateY(-2px);
				box-shadow: 0 6px 12px rgba(37, 211, 102, 0.4);
			}

			.whatsapp-btn .fa {
				font-size: 20px;
			}

			#formMessage {
				text-align: center;
				font-weight: bold;
				padding: 10px;
				border-radius: 5px;
				margin-bottom: 15px;
				display: none;
			}

			#formMessage.success {
				background-color: #d4edda;
				color: #155724;
				border: 1px solid #c3e6cb;
				display: block;
			}

			#formMessage.error {
				background-color: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
				display: block;
			}

			.form-card {
				background-color: #ffffff;
				border-radius: 12px;
				padding: 25px;
				margin-bottom: 15px;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
			}

			.card-title {
				font-weight: 600;
				color: #007bff;
				font-size: 18px;
				border-bottom: 2px solid #007bff;
				padding-bottom: 5px;
				margin-bottom: 20px;
				margin-top: 0;
			}

			/* Photo Upload UI */
			.photo-upload-container {
				display: flex;
				flex-direction: column;
				gap: 15px;
			}
			.photo-buttons {
				display: flex;
				gap: 10px;
			}
			.photo-btn {
				flex: 1;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
				padding: 10px;
				border: 1px solid #007bff;
				border-radius: 6px;
				background-color: #fff;
				color: #007bff;
				cursor: pointer;
				font-weight: 600;
				transition: all 0.3s ease;
			}
			.photo-btn:hover {
				background-color: #f0f7ff;
			}
			.photo-preview-container {
				display: none;
				position: relative;
				width: 100%;
				max-width: 300px;
				margin: 0 auto;
				border-radius: 8px;
				overflow: hidden;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			}
			#photoPreview {
				width: 100%;
				height: auto;
				display: block;
			}
			.remove-photo-btn {
				position: absolute;
				top: 5px;
				right: 5px;
				background-color: rgba(244, 67, 54, 0.9);
				color: white;
				border: none;
				padding: 5px 10px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 12px;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<script>
			const loggedInUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
			if (!loggedInUser) {
				window.location.href = "login.html";
			}
		</script>

		<div class="container">
			<form id="safetyForm">
				<div class="form-card">
					<div
						class="header-banner"
						style="margin: -25px -25px 25px -25px; border-radius: 12px 12px 0 0"
					>
						<img
							src="img/virsim_red.webp"
							alt="Company Logo"
							class="header-logo"
						/>
						<button id="logout-btn">Logout</button>
						<button
							id="admin-dashboard-btn"
							style="
								display: none;
								position: absolute;
								top: 15px;
								right: 100px;
								background-color: rgba(52, 152, 219, 0.8);
								color: white;
								border: none;
								padding: 8px 12px;
								border-radius: 6px;
								cursor: pointer;
								font-size: 14px;
								font-weight: bold;
								backdrop-filter: blur(3px);
								transition: background-color 0.3s ease;
							"
						>
							Go to Admin Dashboard
						</button>
						<div class="language-buttons">
							<div class="language-button" id="lang-id" data-lang="id">
								<img
									src="https://mokhamadabrar.github.io/img/ID.svg"
									alt="Bahasa Indonesia"
								/>
							</div>
							<div class="language-button active" id="lang-en" data-lang="en">
								<img
									src="https://mokhamadabrar.github.io/img/EN.svg"
									alt="English"
								/>
							</div>
						</div>
					</div>
					<h1 data-key="formTitle">Form Observasi Keselamatan (K3)</h1>
					<div id="formMessage"></div>
					<h2 class="card-title" data-key="reporterInfo">Informasi Pelapor</h2>
					<div class="form-group">
						<p style="margin: 0">
							<strong
								><span data-key="observerNameLabel"
									>Nama Observer:</span
								></strong
							>
							<span id="observerNameText">N/A</span>
						</p>
					</div>
					<div class="form-group">
						<p style="margin: 0">
							<strong
								><span data-key="observerCompanyLabel"
									>Perusahaan:</span
								></strong
							>
							<span id="observerCompanyText">N/A</span>
						</p>
					</div>
					<div class="form-group">
						<p style="margin: 0">
							<strong
								><span data-key="observerPositionLabel">Jabatan:</span></strong
							>
							<span id="observerPositionText">N/A</span>
						</p>
					</div>
					<p style="margin-top: 10px">
						<small data-key="contactAdmin"
							>Hubungi admin untuk melakukan perubahan.</small
						>
					</p>
					<div class="form-group" style="margin-bottom: 0">
						<label for="obsDate" data-key="obsDateLabel"
							>Tanggal Observasi:</label
						>
						<input type="date" id="obsDate" name="obsDate" required />
					</div>
				</div>

				<div class="form-card">
					<h2 class="card-title" data-key="observationDetails">
						Observation Details
					</h2>
					<div style="display: flex; gap: 15px; flex-wrap: wrap">
						<div
							class="form-group"
							style="flex: 1; min-width: 150px; margin-bottom: 0"
						>
							<label for="roomArea" data-key="roomAreaLabel">Room/Area:</label>
							<select id="roomArea" name="roomArea" required>
								<option value="" disabled selected data-key="selectOption">
									Select...
								</option>
								<option value="COLO or AZ">COLO or AZ</option>
								<option value="External Area">External Area</option>
							</select>
						</div>
						<div
							class="form-group"
							style="flex: 2; min-width: 250px; margin-bottom: 0"
						>
							<label for="obsLocation" data-key="obsLocationLabel"
								>Lokasi Observasi:</label
							>
							<input
								type="text"
								id="obsLocation"
								name="obsLocation"
								data-placeholder-key="obsLocationPlaceholder"
								placeholder="Contoh: Area Workshop, Gudang B"
								required
							/>
						</div>
					</div>
					<div class="form-group" style="margin-top: 15px; margin-bottom: 0">
						<label for="phaseOfConstruction" data-key="phaseOfConstructionLabel"
							>Phase of Construction:</label
						>
						<select
							id="phaseOfConstruction"
							name="phaseOfConstruction"
							required
						>
							<option value="" disabled selected data-key="selectOption">
								Select...
							</option>
							<option value="Cladding Building Envelope">
								Cladding Building Envelope
							</option>
							<option value="Commissioning">Commissioning</option>
							<option value="Early Works">Early Works</option>
							<option value="Exterior Slabs & Equipment">
								Exterior Slabs & Equipment
							</option>
							<option value="Foundations">Foundations</option>
							<option value="Integration">Integration</option>
							<option value="Interior Fit-out - CSA">
								Interior Fit-out - CSA
							</option>
							<option value="Interior Fit-out - Electrical">
								Interior Fit-out - Electrical
							</option>
							<option value="Interior Fit-out - Mechanical">
								Interior Fit-out - Mechanical
							</option>
							<option value="Interior Slabs">Interior Slabs</option>
							<option value="Interior Underground Services">
								Interior Underground Services
							</option>
							<option value="Network Fit-out">Network Fit-out</option>
							<option value="On-Pause">On-Pause</option>
							<option value="Roofing">Roofing</option>
							<option value="Security">Security</option>
							<option value="Site Clearing & Preparation">
								Site Clearing & Preparation
							</option>
							<option value="Site Utility Services">
								Site Utility Services
							</option>
							<option value="Steel Erection">Steel Erection</option>
							<option value="Tilt Wall Construction">
								Tilt Wall Construction
							</option>
						</select>
					</div>
				</div>

				<div class="form-card">
					<div class="form-group" style="margin-bottom: 0">
						<label data-key="categoriesLabel">Kategori Observasi:</label>
						<div class="category-subtitle" data-key="hraTitle">HRA</div>
						<div class="radio-group-grid">
							<div>
								<input
									type="radio"
									id="cat-heights"
									name="category"
									value="Working from Heights"
									required
								/><label for="cat-heights" data-key="catHeights"
									>Working from Heights</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-lifting"
									name="category"
									value="Lifting Operations"
								/><label for="cat-lifting" data-key="catLifting"
									>Lifting Operations</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-mobile"
									name="category"
									value="Mobile Equipment"
								/><label for="cat-mobile" data-key="catMobile"
									>Mobile Equipment</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-ground"
									name="category"
									value="Ground Disturbance"
								/><label for="cat-ground" data-key="catGround"
									>Ground Disturbance</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-driving"
									name="category"
									value="Driving & Off-Road Vehicles"
								/><label for="cat-driving" data-key="catDriving"
									>Driving & Off-Road Vehicles</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-material"
									name="category"
									value="Material Handling"
								/><label for="cat-material" data-key="catMaterial"
									>Material Handling</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-energy"
									name="category"
									value="Energy Isolation"
								/><label for="cat-energy" data-key="catEnergy"
									>Energy Isolation</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-confined"
									name="category"
									value="Confined Spaces"
								/><label for="cat-confined" data-key="catConfined"
									>Confined Spaces</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-electrical"
									name="category"
									value="Electrical"
								/><label for="cat-electrical" data-key="catElectrical"
									>Electrical</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-noise"
									name="category"
									value="Noise"
								/><label for="cat-noise" data-key="catNoise">Noise</label>
							</div>
							<div>
								<input
									type="radio"
									id="cat-thermal"
									name="category"
									value="Thermal Stress"
								/><label for="cat-thermal" data-key="catThermal"
									>Thermal Stress</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-hazardous"
									name="category"
									value="Hazardous Materials"
								/><label for="cat-hazardous" data-key="catHazardous"
									>Hazardous Materials</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="cat-other-new"
									name="category"
									value="Other"
								/><label for="cat-other-new" data-key="catOtherNew"
									>Other</label
								>
							</div>
						</div>
						<div id="nonHraSection" style="display: none">
							<div class="category-subtitle" data-key="nonHraTitle">
								Non HRA/Other
							</div>
							<div class="radio-group-grid">
								<div>
									<input
										type="radio"
										id="cat-animals"
										name="category"
										value="Animals and Insects"
									/><label for="cat-animals" data-key="catAnimals"
										>Animals and Insects</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-barricades"
										name="category"
										value="Barricades"
									/><label for="cat-barricades" data-key="catBarricades"
										>Barricades</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-biological"
										name="category"
										value="Biological"
									/><label for="cat-biological" data-key="catBiological"
										>Biological</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-documentation"
										name="category"
										value="Documentation"
									/><label for="cat-documentation" data-key="catDocumentation"
										>Documentation</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-emergency"
										name="category"
										value="Emergency Preparedness"
									/><label for="cat-emergency" data-key="catEmergency"
										>Emergency Preparedness</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-environmental"
										name="category"
										value="Environmental"
									/><label for="cat-environmental" data-key="catEnvironmental"
										>Environmental</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-ergonomic"
										name="category"
										value="Ergonomic"
									/><label for="cat-ergonomic" data-key="catErgonomic"
										>Ergonomic</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-fatigue"
										name="category"
										value="Fatigue"
									/><label for="cat-fatigue" data-key="catFatigue"
										>Fatigue</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-fire"
										name="category"
										value="Fire Protection"
									/><label for="cat-fire" data-key="catFire"
										>Fire Protection</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-tools"
										name="category"
										value="Hand or Power Tools"
									/><label for="cat-tools" data-key="catTools"
										>Hand or Power Tools</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-housekeeping"
										name="category"
										value="Housekeeping"
									/><label for="cat-housekeeping" data-key="catHousekeeping"
										>Housekeeping</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-lasers"
										name="category"
										value="Lasers"
									/><label for="cat-lasers" data-key="catLasers">Lasers</label>
								</div>
								<div>
									<input
										type="radio"
										id="cat-lighting"
										name="category"
										value="Lighting"
									/><label for="cat-lighting" data-key="catLighting"
										>Lighting</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-lof"
										name="category"
										value="Line of Fire"
									/><label for="cat-lof" data-key="catLof">Line of Fire</label>
								</div>
								<div>
									<input
										type="radio"
										id="cat-logistics"
										name="category"
										value="Logistics"
									/><label for="cat-logistics" data-key="catLogistics"
										>Logistics</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-lifting-manual"
										name="category"
										value="Manual Lifting"
									/><label for="cat-lifting-manual" data-key="catManualLifting"
										>Manual Lifting</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-office"
										name="category"
										value="Office Tools and Equipment"
									/><label for="cat-office" data-key="catOffice"
										>Office Tools and Equipment</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-ppe"
										name="category"
										value="Personal Protective Equipment"
									/><label for="cat-ppe" data-key="catPpe"
										>Personal Protective Equipment</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-culture"
										name="category"
										value="Safety Culture"
									/><label for="cat-culture" data-key="catCulture"
										>Safety Culture</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-sanitation"
										name="category"
										value="Sanitation"
									/><label for="cat-sanitation" data-key="catSanitation"
										>Sanitation</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-access"
										name="category"
										value="Site Access and Control"
									/><label for="cat-access" data-key="catAccess"
										>Site Access and Control</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-training"
										name="category"
										value="Training"
									/><label for="cat-training" data-key="catTraining"
										>Training</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-ventilation"
										name="category"
										value="Ventilation"
									/><label for="cat-ventilation" data-key="catVentilation"
										>Ventilation</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-surfaces"
										name="category"
										value="Walking, Working Surfaces"
									/><label for="cat-surfaces" data-key="catSurfaces"
										>Walking, Working Surfaces</label
									>
								</div>
								<div>
									<input
										type="radio"
										id="cat-welding"
										name="category"
										value="Welding, Cutting and Grinding"
									/><label for="cat-welding" data-key="catWelding"
										>Welding, Cutting and Grinding</label
									>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="form-card">
					<div class="form-group" style="margin-bottom: 0">
						<label data-key="obsTypeLabel">Jenis Observasi:</label>
						<div class="radio-group-grid">
							<div>
								<input
									type="radio"
									id="newPositiveObservation"
									name="obsType"
									value="New Positive Observation"
									required
								/>
								<label
									for="newPositiveObservation"
									data-key="NewPositiveObservation"
									>New Positive Observation</label
								>
							</div>
							<div>
								<input
									type="radio"
									id="newAtRiskObservation"
									name="obsType"
									value="New At Risk Observation"
								/>
								<label
									for="newAtRiskObservation"
									data-key="NewAtRiskObservation"
									>New At Risk Observation</label
								>
							</div>
						</div>
					</div>
				</div>

				<div class="form-card">
					<div class="form-group" style="position: relative">
						<div
							style="
								display: flex;
								justify-content: space-between;
								align-items: center;
								margin-bottom: 6px;
							"
						>
							<label
								for="description"
								data-key="descriptionLabel"
								style="margin-bottom: 0"
								>Deskripsi Observasi:</label
							>
							<button
								type="button"
								class="translate-btn"
								data-target="description"
								style="
									background: none;
									border: none;
									color: #007bff;
									cursor: pointer;
									font-size: 12px;
									font-weight: bold;
								"
							>
								<i class="fa fa-language"></i> Translate to English
							</button>
						</div>
						<textarea
							id="description"
							name="description"
							rows="5"
							data-placeholder-key="descriptionPlaceholder"
							placeholder="Jelaskan apa yang Anda lihat..."
							required
						></textarea>
					</div>
					<div id="immediateActionGroup" style="display: none">
						<div class="form-group" style="position: relative">
							<div
								style="
									display: flex;
									justify-content: space-between;
									align-items: center;
									margin-bottom: 6px;
								"
							>
								<label
									for="immediateAction"
									data-key="immediateActionLabel"
									style="margin-bottom: 0"
									>Immediate Action:</label
								>
								<button
									type="button"
									class="translate-btn"
									data-target="immediateAction"
									style="
										background: none;
										border: none;
										color: #007bff;
										cursor: pointer;
										font-size: 12px;
										font-weight: bold;
									"
								>
									<i class="fa fa-language"></i> Translate to English
								</button>
							</div>
							<textarea
								id="immediateAction"
								name="immediateAction"
								rows="3"
								data-placeholder-key="immediateActionPlaceholder"
								placeholder="Contoh: Menegur pekerja, menghentikan pekerjaan, membersihkan tumpahan..."
							></textarea>
						</div>
						<!-- Akan digunakan di masa mendatang -->
						<div class="form-group" style="margin-bottom: 0; display: none">
							<label for="unsafeEmail" data-key="unsafeEmailLabel"
								>Email Address:</label
							>
							<input
								type="email"
								id="unsafeEmail"
								name="unsafeEmail"
								data-placeholder-key="unsafeEmailPlaceholder"
								placeholder="Enter email address..."
							/>
						</div>
					</div>
				</div>

				<div class="form-card">
					<div class="form-group" style="margin-bottom: 0">
						<label data-key="uploadPhotoLabel">Unggah Foto (Opsional):</label>
						<div class="photo-upload-container">
							<div class="photo-buttons">
								<button type="button" class="photo-btn" id="galleryBtn">
									<i class="fa fa-image"></i>
									<span data-key="galleryButton">Gallery</span>
								</button>
								<button type="button" class="photo-btn" id="cameraBtn">
									<i class="fa fa-camera"></i>
									<span data-key="cameraButton">Camera</span>
								</button>
							</div>

							<!-- Hidden inputs -->
							<input
								type="file"
								id="uploadPhotoGallery"
								accept="image/*"
								style="display: none"
							/>
							<input
								type="file"
								id="uploadPhotoCamera"
								accept="image/*"
								capture="environment"
								style="display: none"
							/>

							<!-- Preview -->
							<div id="previewContainer" class="photo-preview-container">
								<img id="photoPreview" src="" alt="Preview" />
								<button
									type="button"
									id="removePhotoBtn"
									class="remove-photo-btn"
									data-key="removePhotoButton"
								>
									Remove Photo
								</button>
							</div>
						</div>
					</div>
				</div>

				<button
					type="submit"
					class="submit-btn"
					data-key="submitButton"
					name="submitAction"
					value="submit"
				>
					Kirim Laporan
				</button>

				<button
					type="submit"
					id="whatsapp-share-btn"
					class="whatsapp-btn"
					name="submitAction"
					value="whatsapp"
				>
					<i class="fa fa-whatsapp" style="color: white"></i>
					<span data-key="shareButton">Bagikan ke WhatsApp</span>
				</button>
			</form>
		</div>

		<!-- Confirmation Modal -->
		<div
			id="confirmSubmitModal"
			class="modal-overlay"
			style="
				display: none;
				position: fixed;
				z-index: 1000;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				overflow: auto;
				background-color: rgba(0, 0, 0, 0.5);
				justify-content: center;
				align-items: center;
			"
		>
			<div
				class="modal-content"
				style="
					background-color: #fefefe;
					margin: auto;
					padding: 20px;
					border: 1px solid #888;
					width: 80%;
					max-width: 400px;
					border-radius: 8px;
					text-align: center;
				"
			>
				<h3 data-key="confirmSubmitTitle">Konfirmasi Pengiriman</h3>
				<p data-key="confirmSubmitMessage">
					Apakah Anda yakin ingin mengirim laporan ini?
				</p>
				<div
					style="
						display: flex;
						justify-content: center;
						gap: 10px;
						margin-top: 20px;
					"
				>
					<button
						id="cancelSubmitBtn"
						class="submit-btn"
						style="background-color: #95a5a6; width: auto"
						data-key="cancelButton"
					>
						Batal
					</button>
					<button
						id="confirmSubmitBtn"
						class="submit-btn"
						style="width: auto"
						data-key="confirmYesButton"
					>
						Ya, Kirim
					</button>
				</div>
			</div>
		</div>

		<!-- Success Modal -->
		<div
			id="successSubmitModal"
			class="modal-overlay"
			style="
				display: none;
				position: fixed;
				z-index: 1000;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				overflow: auto;
				background-color: rgba(0, 0, 0, 0.5);
				justify-content: center;
				align-items: center;
			"
		>
			<div
				class="modal-content"
				style="
					background-color: #fefefe;
					margin: auto;
					padding: 20px;
					border: 1px solid #888;
					width: 80%;
					max-width: 400px;
					border-radius: 8px;
					text-align: center;
				"
			>
				<h3 data-key="successSubmitTitle">Berhasil!</h3>
				<p data-key="successSubmitMessage">
					Laporan Anda telah berhasil dikirim.
				</p>
				<div style="display: flex; justify-content: center; margin-top: 20px">
					<button
						id="closeSuccessBtn"
						class="submit-btn"
						style="width: auto"
						data-key="closeButton"
					>
						Tutup
					</button>
				</div>
			</div>
		</div>

		<!-- Firebase Scripts -->
		<!-- These scripts are now served by Firebase Hosting -->
		<script src="/__/firebase/8.6.1/firebase-app.js"></script>
		<script src="/__/firebase/8.6.1/firebase-auth.js"></script>
		<script src="/__/firebase/8.6.1/firebase-firestore.js"></script>
		<script src="/__/firebase/8.6.1/firebase-storage.js"></script>
		<script src="/__/firebase/init.js"></script>

		<!-- Other scripts -->
		<script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
		<script src="js/firebase-init.js"></script>
		<script src="js/translations.js"></script>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				// --- AUTO-FILL & USER SESSION ---
				const loggedInUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
				if (!loggedInUser) {
					window.location.href = "login.html";
				}

				document
					.getElementById("logout-btn")
					.addEventListener("click", function () {
						sessionStorage.removeItem("loggedInUser");
						sessionStorage.removeItem("adminUser"); // Clear admin session as well
						window.location.href = "login.html";
					});

				// Admin Dashboard Button Logic
				const adminDashboardBtn = document.getElementById(
					"admin-dashboard-btn",
				);
				const adminUser = JSON.parse(sessionStorage.getItem("adminUser"));
				if (adminUser) {
					adminDashboardBtn.style.display = "block"; // Show the button
					adminDashboardBtn.addEventListener("click", function () {
						window.location.href = "dashboard.html";
					});
				}

				async function loadReporterInfo() {
					const nameSpan = document.getElementById("observerNameText");
					const companySpan = document.getElementById("observerCompanyText");
					const positionSpan = document.getElementById("observerPositionText");
					const locationInput = document.getElementById("obsLocation");
					const roomAreaInput = document.getElementById("roomArea");

					let name = "N/A";
					let company = "N/A";
					let position = "N/A";

					// Try to get data from Firestore first
					try {
						const userDoc = await db
							.collection("users")
							.doc(loggedInUser.uid)
							.get();
						if (userDoc.exists) {
							const userData = userDoc.data();
							name = userData.displayName || loggedInUser.displayName || "N/A";
							company = userData.company || "N/A";
							position = userData.position || "N/A";
						} else {
							name = loggedInUser.displayName || "N/A";
						}
					} catch (error) {
						console.error("Error fetching user data from Firestore:", error);
						name = loggedInUser.displayName || "N/A";
					}

					// Load from localStorage
					const location = localStorage.getItem(
						`${loggedInUser.uid}_reporterLocation`,
					);
					const roomArea = localStorage.getItem(`${loggedInUser.uid}_roomArea`);

					nameSpan.textContent = name;
					companySpan.textContent = company;
					positionSpan.textContent = position;
					if (location) locationInput.value = location;
					if (roomArea) roomAreaInput.value = roomArea;

					// Set today's date
					const today = new Date();
					const yyyy = today.getFullYear();
					const mm = String(today.getMonth() + 1).padStart(2, "0"); // Months are 0-based
					const dd = String(today.getDate()).padStart(2, "0");
					const todayFormatted = `${yyyy}-${mm}-${dd}`;
					document.getElementById("obsDate").value = todayFormatted;
					document
						.getElementById("obsDate")
						.setAttribute("max", todayFormatted);
				}

				function saveReporterInfo() {
					localStorage.setItem(
						`${loggedInUser.uid}_reporterLocation`,
						document.getElementById("obsLocation").value,
					);
					localStorage.setItem(
						`${loggedInUser.uid}_roomArea`,
						document.getElementById("roomArea").value,
					);
				}

				loadReporterInfo();

				// --- FORM & TRANSLATION SETUP ---
				const safetyForm = document.getElementById("safetyForm");
				const messageDiv = document.getElementById("formMessage");
				const langButtons = document.querySelectorAll(".language-button");

				let currentLang = "en";

				function applyTranslation(lang) {
					document.querySelectorAll("[data-key]").forEach((element) => {
						const key = element.getAttribute("data-key");
						if (translations[lang][key]) {
							element.textContent = translations[lang][key];
						}
					});
					document
						.querySelectorAll("[data-placeholder-key]")
						.forEach((element) => {
							const key = element.getAttribute("data-placeholder-key");
							if (translations[lang][key]) {
								element.placeholder = translations[lang][key];
							}
						});
					langButtons.forEach((button) => {
						button.classList.remove("active");
						if (button.dataset.lang === lang) {
							button.classList.add("active");
						}
					});
					currentLang = lang;
				}

				langButtons.forEach((button) => {
					button.addEventListener("click", function () {
						const lang = this.dataset.lang;
						applyTranslation(lang);
					});
				});

				applyTranslation(currentLang);

				// --- DYNAMIC FORM LOGIC ---
				const immediateActionGroup = document.getElementById(
					"immediateActionGroup",
				);
				const obsTypeRadios = document.querySelectorAll(
					'input[name="obsType"]',
				);
				const immediateActionInput = document.getElementById("immediateAction");
				const unsafeEmailInput = document.getElementById("unsafeEmail");

				function updateRequiredFields(isUnsafe) {
					if (isUnsafe) {
						immediateActionGroup.style.display = "block";
						immediateActionInput.setAttribute("required", "required");
					} else {
						immediateActionGroup.style.display = "none";
						immediateActionInput.removeAttribute("required");
						immediateActionInput.value = ""; // Optional: clear value if hidden
						unsafeEmailInput.value = ""; // Optional: clear value if hidden
					}
				}

				obsTypeRadios.forEach((radio) => {
					radio.addEventListener("change", function () {
						updateRequiredFields(this.value === "New At Risk Observation");
					});
				});

				// --- CATEGORY TOGGLE LOGIC ---
				const categoryRadios = document.querySelectorAll(
					'input[name="category"]',
				);
				const nonHraSection = document.getElementById("nonHraSection");

				function updateCategoryVisibility() {
					const checkedRadio = document.querySelector(
						'input[name="category"]:checked',
					);
					if (!checkedRadio) return;

					if (checkedRadio.value === "Other") {
						nonHraSection.style.display = "block";
					} else if (checkedRadio.closest("#nonHraSection")) {
						// Selected item is inside the Non-HRA section, do nothing (keep visible)
						nonHraSection.style.display = "block";
					} else {
						// Selected item is a standard HRA category
						nonHraSection.style.display = "none";
					}
				}

				categoryRadios.forEach((radio) => {
					radio.addEventListener("change", updateCategoryVisibility);
				});

				// Run on load
				updateCategoryVisibility();

				// --- TRANSLATION LOGIC (MyMemory API) ---
				async function translateText(text, targetLang = "en") {
					if (!text || text.trim() === "") return null;
					// MyMemory API endpoint
					const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=id|${targetLang}`;

					try {
						const response = await fetch(url);
						const data = await response.json();
						if (data.responseStatus === 200) {
							return data.responseData.translatedText;
						} else {
							console.error("Translation API Error:", data.responseDetails);
							return null;
						}
					} catch (error) {
						console.error("Network Error during translation:", error);
						return null;
					}
				}

				document.querySelectorAll(".translate-btn").forEach((btn) => {
					btn.addEventListener("click", async function () {
						const targetId = this.getAttribute("data-target");
						const textarea = document.getElementById(targetId);
						const originalText = textarea.value;

						if (!originalText) {
							alert("Please enter text to translate first.");
							return;
						}

						// Visual feedback
						const originalBtnText = this.innerHTML;
						this.innerHTML =
							'<i class="fa fa-spinner fa-spin"></i> Translating...';
						this.disabled = true;

						const translatedText = await translateText(originalText, "en");

						if (translatedText) {
							textarea.value = translatedText;
						} else {
							alert(
								"Translation failed. Please try again or check your connection.",
							);
						}

						// Restore button state
						this.innerHTML = originalBtnText;
						this.disabled = false;
					});
				});

				// --- PHOTO UPLOAD LOGIC ---
				const galleryBtn = document.getElementById("galleryBtn");
				const cameraBtn = document.getElementById("cameraBtn");
				const galleryInput = document.getElementById("uploadPhotoGallery");
				const cameraInput = document.getElementById("uploadPhotoCamera");
				const previewContainer = document.getElementById("previewContainer");
				const photoPreview = document.getElementById("photoPreview");
				const removePhotoBtn = document.getElementById("removePhotoBtn");
				let selectedFile = null;

				galleryBtn.addEventListener("click", () => galleryInput.click());
				cameraBtn.addEventListener("click", () => cameraInput.click());

				function handleFileSelect(e) {
					const file = e.target.files[0];
					if (file) {
						selectedFile = file;
						const reader = new FileReader();
						reader.onload = function (event) {
							photoPreview.src = event.target.result;
							previewContainer.style.display = "block";
						};
						reader.readAsDataURL(file);
					}
				}

				galleryInput.addEventListener("change", handleFileSelect);
				cameraInput.addEventListener("change", handleFileSelect);

				removePhotoBtn.addEventListener("click", () => {
					selectedFile = null;
					galleryInput.value = "";
					cameraInput.value = "";
					previewContainer.style.display = "none";
					photoPreview.src = "";
				});

				// --- MODAL ELEMENTS ---
				const confirmSubmitModal =
					document.getElementById("confirmSubmitModal");
				const successSubmitModal =
					document.getElementById("successSubmitModal");
				const confirmSubmitBtn = document.getElementById("confirmSubmitBtn");
				const cancelSubmitBtn = document.getElementById("cancelSubmitBtn");
				const closeSuccessBtn = document.getElementById("closeSuccessBtn");
				let pendingSubmitAction = null;

				// Close modals on outside click
				window.addEventListener("click", (event) => {
					if (event.target == confirmSubmitModal)
						confirmSubmitModal.style.display = "none";
					if (event.target == successSubmitModal)
						successSubmitModal.style.display = "none";
				});

				cancelSubmitBtn.addEventListener("click", () => {
					confirmSubmitModal.style.display = "none";
				});

				closeSuccessBtn.addEventListener("click", () => {
					successSubmitModal.style.display = "none";
					safetyForm.reset();
					removePhotoBtn.click();
					loadReporterInfo();
					window.scrollTo(0, 0);
				});

				confirmSubmitBtn.addEventListener("click", () => {
					confirmSubmitModal.style.display = "none";
					executeSubmission(pendingSubmitAction);
				});

				function shareViaWhatsApp(data, photoURL) {
					const phoneNumber = "6281285989142";
					let message = `*New Safety Observation Report*\n\n`;
					message += `*Observer Name:* ${data.observerName || "N/A"}\n`;
					message += `*Company:* ${data.observerCompany || "N/A"}\n`;
					message += `*Position:* ${data.observerPosition || "N/A"}\n`;
					message += `*Room/Area:* ${data.roomArea || "N/A"}\n`;
					message += `*Location:* ${data.obsLocation || "N/A"}\n`;
					message += `*Phase of Construction:* ${data.phaseOfConstruction || "N/A"}\n`;
					message += `*Date:* ${data.obsDate || "N/A"}\n\n`;
					message += `*--- Observation Details ---*\n`;
					message += `*Category:* ${data.category || "N/A"}\n`;
					message += `*Type:* ${data.obsType || "N/A"}\n`;
					message += `*Description:*\n${data.description || "N/A"}\n\n`;
					message += `*Actions & Recommendations:*\n${data.immediateAction || "N/A"}\n\n`;

					if (photoURL) {
						message += `*Photo Link:* ${photoURL}\n`;
					} else {
						message += `*Photo:* No photo attached.\n`;
					}

					const encodedMessage = encodeURIComponent(message);
					const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
					window.open(whatsappUrl, "_blank");
				}

				safetyForm.addEventListener("submit", async function (event) {
					event.preventDefault();
					pendingSubmitAction = event.submitter
						? event.submitter.value
						: "submit";

					const obsDateInput = document.getElementById("obsDate");
					const dateValue = obsDateInput.value;
					const dateParts = dateValue.split("-"); // YYYY-MM-DD
					const selectedDate = new Date(
						dateParts[0],
						dateParts[1] - 1,
						dateParts[2],
					);

					const today = new Date();
					today.setHours(0, 0, 0, 0);

					if (selectedDate > today) {
						messageDiv.innerHTML = translations[currentLang].errorFutureDate;
						messageDiv.className = "form-message error";
						messageDiv.style.display = "block";
						setTimeout(() => {
							messageDiv.style.display = "none";
						}, 6000);
						return;
					}

					// Category Validation: Cannot be "Other"
					const selectedCategory = document.querySelector(
						'input[name="category"]:checked',
					);
					if (selectedCategory && selectedCategory.value === "Other") {
						messageDiv.innerHTML = translations[currentLang].errorOtherCategory;
						messageDiv.className = "form-message error";
						messageDiv.style.display = "block";
						// Scroll to category section
						const nonHraSection = document.getElementById("nonHraSection");
						if (nonHraSection) {
							nonHraSection.style.display = "block"; // Ensure it's visible
							nonHraSection.scrollIntoView({ behavior: "smooth" });
						}
						setTimeout(() => {
							messageDiv.style.display = "none";
						}, 6000);
						return;
					}

					// Email Validation
					const emailInput = document.getElementById("unsafeEmail");
					if (emailInput && emailInput.value) {
						const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
						if (!emailPattern.test(emailInput.value)) {
							messageDiv.innerHTML =
								translations[currentLang].errorInvalidEmail;
							messageDiv.className = "form-message error";
							messageDiv.style.display = "block";
							setTimeout(() => {
								messageDiv.style.display = "none";
							}, 6000);
							return;
						}
					}

					// Show Confirmation Modal
					confirmSubmitModal.style.display = "flex";
				});

				async function executeSubmission(submitAction) {
					const submitButtons = safetyForm.querySelectorAll(
						'button[type="submit"]',
					);
					submitButtons.forEach((btn) => (btn.disabled = true));

					// Use the "Submit" button for text feedback, or default if whatsapp was clicked
					const originalButton = document.querySelector(".submit-btn");
					const originalButtonText = originalButton.textContent;
					originalButton.textContent =
						translations[currentLang].submittingButton;

					messageDiv.style.display = "none";

					try {
						// 1. Save reporter info for next time
						saveReporterInfo();

						// 2. Handle File Upload to Cloudinary
						let file = selectedFile;
						let photoURL = "";

						if (file) {
							console.log(`Original file size: ${file.size / 1024 / 1024} MB`);
							const options = {
								maxSizeMB: 0.05,
								maxWidthOrHeight: 1920,
								useWebWorker: true,
							};
							const compressedFile = await imageCompression(file, options);
							console.log(
								`Compressed file size: ${compressedFile.size / 1024 / 1024} MB`,
							);
							file = compressedFile; // Use the compressed file for upload

							const cloudName = "dnk3hccmm";
							const uploadPreset = "unsigned_reports";
							const cloudinaryUrl = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;

							const formData = new FormData();
							formData.append("file", file);
							formData.append("upload_preset", uploadPreset);
							formData.append("folder", "observationform");

							const response = await fetch(cloudinaryUrl, {
								method: "POST",
								body: formData,
							});

							if (!response.ok) {
								throw new Error("Cloudinary upload failed");
							}

							const cloudinaryData = await response.json();
							photoURL = cloudinaryData.secure_url;
						}

						// 3. Prepare data for Firestore
						const formElementData = new FormData(safetyForm);
						const dataToSave = {};
						formElementData.forEach((value, key) => {
							if (key !== "uploadPhoto" && key !== "submitAction") {
								dataToSave[key] = value;
							}
						});

						// Add the static reporter info to the data to be saved
						dataToSave.observerName =
							document.getElementById("observerNameText").textContent;
						dataToSave.observerCompany = document.getElementById(
							"observerCompanyText",
						).textContent;
						dataToSave.observerPosition = document.getElementById(
							"observerPositionText",
						).textContent;

						dataToSave.photoURL = photoURL;
						dataToSave.submittedAt =
							firebase.firestore.FieldValue.serverTimestamp();
						dataToSave.submittedBy = loggedInUser.email;

						// 4. Save to Firestore
						await db.collection("observations").add(dataToSave);

						// 5. Send Email via EmailJS (if email provided)
						if (dataToSave.unsafeEmail) {
							try {
								const templateParams = {
									to_email: dataToSave.unsafeEmail,
									observer_name: dataToSave.observerName,
									company: dataToSave.observerCompany,
									position: dataToSave.observerPosition,
									location: dataToSave.obsLocation,
									date: dataToSave.obsDate,
									category: dataToSave.category,
									obs_type: dataToSave.obsType,
									description: dataToSave.description,
									immediate_action: dataToSave.immediateAction,
									photo_url: dataToSave.photoURL || "No photo attached",
								};

								await emailjs.send(
									"service_nwzjwla",
									"template_bfxlsi5",
									templateParams,
								);
								console.log("Email sent successfully via EmailJS");
							} catch (emailError) {
								console.error("Failed to send email via EmailJS:", emailError);
							}
						}

						// 6. Handle WhatsApp sharing if needed
						if (submitAction === "whatsapp") {
							shareViaWhatsApp(dataToSave, photoURL);
						}

						// 7. Show Success Modal
						successSubmitModal.style.display = "flex";
					} catch (error) {
						// 8. Error Feedback
						console.error("Error submitting report: ", error);
						messageDiv.innerHTML = translations[currentLang].errorMessage;
						messageDiv.className = "form-message error";
						messageDiv.style.display = "block";
					} finally {
						// 9. Reset button state
						submitButtons.forEach((btn) => (btn.disabled = false));
						originalButton.textContent = originalButtonText;
					}
				}
			});
		</script>
	</body>
</html>
